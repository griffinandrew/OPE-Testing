name: gdb test jon 
on:
  push:
    branches: 
      - '*'
jobs:
  gdb:
    runs-on: ubuntu-latest #use the latest ubuntu container image 
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4 #use action to install python
        with:
          python-version: "3.9"
      - name: Install dependencies #requirements docs unable to read, hard installing dependencies 
        run: |
          pip install -r requirements/requirements.txt    
      - name: build # makes the container image build and then creates var with checksum value to be compared 
        run: |
          make build
      - name: run gdb #creates var with checksum value to be compared 
        run: |
         IMAGE=$(docker images --format "{{.Repository}}:{{.Tag}}" | head -n 1)
         docker run -d --name stable $IMAGE
         docker exec stable bash -c 'for ((i=0;i<100; i++)); do gdb -ex starti -ex quit -q --batch /usr/bin/date 2>/dev/null | grep ld; done' | tee out | uniq
         expected_lines=100
         actual_lines=$(wc -l < out)
         echo $actual_lines
         if [ "$actual_lines" -lt "$expected_lines" ]; then
         echo "******************Test failed****************" #if the output file contians no iterations through the test file, gdb has failed
         else
         echo "******************Test passed***************"
         fi





